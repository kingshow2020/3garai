<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¹Ù‚Ø§Ø±ÙŠ AI - ØªÙ‚Ø¯ÙŠØ± Ø³Ø¹Ø± Ø§Ù„Ø£Ø±Ø¶</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f4f8; margin: 0; padding: 0; }
    .container { max-width: 700px; margin: 3rem auto; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #2c3e50; margin-bottom: 2rem; }
    label { font-weight: bold; display: block; margin-top: 1rem; }
    input, select, button {
      width: 100%; padding: 0.8rem; margin-top: 0.5rem;
      border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;
    }
    button {
      background: #2d89ef; color: white; border: none; cursor: pointer; margin-top: 1.5rem;
    }
    button:hover { background: #1b61c1; }
    #result { margin-top: 2rem; font-size: 1.2rem; color: #333; text-align: center; }
    .metrics-box { background: #e8f0fe; padding: 1rem; margin-top: 2rem; border-radius: 8px; }
    .accuracy-bar { margin-top: 1rem; background: #ddd; border-radius: 10px; overflow: hidden; height: 20px; }
    .accuracy-fill { background: #38a169; height: 100%; text-align: center; color: white; font-size: 0.9rem; line-height: 20px; }
    .upload-box { background: #fefcbf; padding: 1rem; margin-top: 2rem; border-radius: 8px; }
    .success { color: green; margin-top: 0.5rem; font-weight: bold; }
    .error { color: red; margin-top: 0.5rem; font-weight: bold; }
    .log-box { background: #fff; border: 1px solid #ccc; margin-top: 1rem; padding: 0.5rem; border-radius: 6px; font-size: 0.9rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø­Ø§Ø³Ø¨Ø© Ø¹Ù‚Ø§Ø±ÙŠ AI</h1>
    <form id="predictForm">
      <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
      <select id="city" name="city" required onchange="updateDistricts()">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
        <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
        <option value="Ø¬Ø¯Ø©">Ø¬Ø¯Ø©</option>
        <option value="Ù…ÙƒØ©">Ù…ÙƒØ©</option>
        <option value="Ø§Ù„Ø¯Ù…Ø§Ù…">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
        <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
        <option value="Ø§Ù„Ø·Ø§Ø¦Ù">Ø§Ù„Ø·Ø§Ø¦Ù</option>
        <option value="Ø£Ø¨Ù‡Ø§">Ø£Ø¨Ù‡Ø§</option>
      </select>

      <label for="district">Ø§Ù„Ø­ÙŠ</label>
      <select id="district" name="district" required></select>

      <label for="type">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
      <select id="type" name="type" required>
        <option value="Ø³ÙƒÙ†ÙŠ">Ø³ÙƒÙ†ÙŠ</option>
        <option value="ØªØ¬Ø§Ø±ÙŠ">ØªØ¬Ø§Ø±ÙŠ</option>
        <option value="Ø²Ø±Ø§Ø¹ÙŠ">Ø²Ø±Ø§Ø¹ÙŠ</option>
      </select>

      <label for="size">Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)</label>
      <input type="number" id="size" name="size" required>

      <label for="face">Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</label>
      <select id="face" name="face" required>
        <option value="Ø´Ù…Ø§Ù„">Ø´Ù…Ø§Ù„</option>
        <option value="Ø¬Ù†ÙˆØ¨">Ø¬Ù†ÙˆØ¨</option>
        <option value="Ø´Ø±Ù‚">Ø´Ø±Ù‚</option>
        <option value="ØºØ±Ø¨">ØºØ±Ø¨</option>
      </select>

      <label for="usage">Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
      <select id="usage" name="usage" required>
        <option value="Ø³ÙƒÙ†ÙŠ ÙÙ‚Ø·">Ø³ÙƒÙ†ÙŠ ÙÙ‚Ø·</option>
        <option value="ØªØ¬Ø§Ø±ÙŠ ÙÙ‚Ø·">ØªØ¬Ø§Ø±ÙŠ ÙÙ‚Ø·</option>
        <option value="Ø³ÙƒÙ†ÙŠ ÙˆØªØ¬Ø§Ø±ÙŠ">Ø³ÙƒÙ†ÙŠ ÙˆØªØ¬Ø§Ø±ÙŠ</option>
      </select>

      <button type="submit">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</button>
    </form>
    <div id="result"></div>

    <div class="metrics-box" id="metrics"></div>
    <div class="metrics-box">
      <strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</strong>
      <div class="accuracy-bar">
        <div id="accuracyFill" class="accuracy-fill" style="width: 0%">0%</div>
      </div>
    </div>

    <div class="upload-box">
      <strong>ğŸ“¤ Ø·ÙˆØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù…Ù„Ù CSV Ø®Ø§Øµ Ø¨Ùƒ:</strong>
      <input type="file" id="csvFile" accept=".csv">
      <button onclick="uploadCSV()">Ø±ÙØ¹ ÙˆØªØ¯Ø±ÙŠØ¨</button>
      <p style="font-size: 0.9rem; margin-top: 0.5rem;">ğŸ“ Ø£Ùˆ <a href="/static/example.csv" download>Ø­Ù…Ù‘Ù„ Ù†Ù…ÙˆØ°Ø¬ CSV Ø¬Ø§Ù‡Ø²</a></p>
      <div id="uploadStatus"></div>
      <div id="uploadLog" class="log-box"></div>
    </div>
  </div>

  <script>
    const cityDistricts = {
      "Ø§Ù„Ø±ÙŠØ§Ø¶": ["Ø§Ù„Ù†Ø±Ø¬Ø³", "Ø§Ù„Ø±ÙˆØ§Ø¨ÙŠ", "Ø§Ù„Ù…Ù„Ø²", "Ø§Ù„Ø¹Ø²ÙŠØ²ÙŠØ©", "Ø§Ù„Ù†Ø³ÙŠÙ…"],
      "Ø¬Ø¯Ø©": ["Ø§Ù„Ø³Ù„Ø§Ù…Ø©", "Ø§Ù„ÙÙŠØµÙ„ÙŠØ©", "Ø§Ù„Ø¨ÙˆØ§Ø¯ÙŠ", "Ø§Ù„Ø±ÙˆÙŠØ³"],
      "Ù…ÙƒØ©": ["Ø§Ù„Ø´ÙˆÙ‚ÙŠØ©", "Ø§Ù„Ø¹ÙˆØ§Ù„ÙŠ", "Ø§Ù„Ø¹ØªÙŠØ¨ÙŠØ©"],
      "Ø§Ù„Ø¯Ù…Ø§Ù…": ["Ø§Ù„Ø´Ø§Ø·Ø¦", "Ø§Ù„Ø¹Ø¯Ø§Ù…Ø©", "Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠÙŠÙ†"],
      "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©": ["Ø§Ù„Ø¹Ø²ÙŠØ²ÙŠØ©", "Ø§Ù„Ø¨Ø±ÙƒØ©", "Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©"],
      "Ø§Ù„Ø·Ø§Ø¦Ù": ["Ù‚Ø±ÙˆÙ‰", "Ø§Ù„Ø±Ù…ÙŠØ¯Ø©", "Ø´Ù‡Ø§Ø±"],
      "Ø£Ø¨Ù‡Ø§": ["Ø§Ù„Ù…Ù†Ø³Ùƒ", "Ø§Ù„Ø³Ø±ÙˆØ§Øª", "Ø§Ù„Ù…Ø±ÙˆØ¬"]
    };

    function updateDistricts() {
      const city = document.getElementById("city").value;
      const districtSelect = document.getElementById("district");
      districtSelect.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ø§Ù„Ø­ÙŠ</option>";
      if (cityDistricts[city]) {
        cityDistricts[city].forEach(d => {
          const opt = document.createElement("option");
          opt.value = d;
          opt.textContent = d;
          districtSelect.appendChild(opt);
        });
      }
    }

    document.getElementById("predictForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const res = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          "Ø§Ù„Ù…Ø³Ø§Ø­Ø©": parseFloat(document.getElementById("size").value),
          "Ø§Ù„Ù†ÙˆØ¹": document.getElementById("type").value,
          "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©": document.getElementById("city").value,
          "Ø§Ù„Ø­ÙŠ": document.getElementById("district").value,
          "Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©": document.getElementById("face").value,
          "Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…": document.getElementById("usage").value
        })
      });
      const data = await res.json();
      if (data["Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹"]) {
        document.getElementById("result").innerHTML =
          `<strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ${data["Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹"]}<br><strong>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¢Ù…Ù†:</strong> ${data["Ø§Ù„Ø­Ø¯ Ø§Ù„Ø¢Ù…Ù† Ù„Ù„Ù…Ø²Ø§ÙŠØ¯Ø©"]}`;
      } else {
        document.getElementById("result").innerText = data.error || "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙˆÙ‚Ø¹.";
      }
    });
  </script>
</body>
</html>
